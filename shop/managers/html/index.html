<? include "../html/top_inc.html"; ?>

<div style="width:100%;" id="IDS_DIV_FRAME2">

<? 
$DATE1 = date("m-d");
$DATE2 = date("m-d", strtotime('-1 DAY', time()));
$DATE3 = date("m-d", strtotime('-2 DAY', time()));
$date_arr = Array('0','1','2','7','30','');

$sql = "SELECT code FROM mall_aconf WHERE mode='T'";
$infos = $mysql->get_one($sql);
$infos = explode("|",$infos);

if($admin_infos[5]==1) { 
?>
	<div class="mainBox" id="totalBox">
		<span toggle='drag'>
		<div class="top">
			<div style="padding:7px 0 0 12px;">
				<div class='left'><img src="../html/img/mainBox_ttl_total.gif" alt="쇼핑몰통계" /></div>				
				<div style='float:right;padding-right:8px;'>
					<span toggle='expand' attr:min="Gopened(this,'total')" attr:max="Gclosed(this,'total')" attr:animate='none' attr:strata="5"><img src="../html/img/icon_fold.gif" alt="접기" title="접기" class="hand" /></span>
				</div>
				<div style='float:right;padding-right:4px;'>
					<img src="../html/img/icon_conf.gif" alt="설정" title="설정" onclick="confClick('total')" class="hand" />
				</div>
				<div style='float:right;padding-right:8px;'>
					<span toggle='down' attr:animate='none' title="Down" attr:strata="5"><img src="../html/img/icon_down.gif" alt="아래로" class="hand" /></span>
				</div>
				<div style='float:right;padding-right:8px;'>
					<span toggle='up' attr:animate='none' title="Up" attr:strata="5"><img src="../html/img/icon_up.gif" alt="위로" class="hand" /></span>
				</div>
			</div>
		</div>
		</span>
		<span toggle='gadget'>
		<div class="content">
			<div class='content_top'></div>			
			<div style="padding:0 6px 0 6px;">
			<table border=0 cellpadding=0 cellspacing=3 width=99% bgcolor='#EEEEEE' align="center">
			<tr>
				<td>
					<table border=0 cellpadding=0 cellspacing=0 width=100% bgcolor='#bbbbbb'>
					<tr>
						<td align=center>
							<table border=0 cellpadding="0" cellspacing="1" width="100%" align=center>
							<tr height=26>							
								<td align=center class=gr_bg3></td>
								<td width=14% align=center class=gr_bg3><font class="bTitle eng"><?=$DATE1?> (<font class="orange num">TODAY</font>)</font></td>
								<td width=14% align=center class=gr_bg3><font class="bTitle eng"><?=$DATE2?></font></td>
								<td width=14% align=center class=gr_bg3><font class="bTitle eng"><?=$DATE3?></font></td>
								<td width=14% align=center class=gr_bg3><font class="bTitle small">최근<font class=eng>1</font>주</font></td>
								<td width=14% align=center class=gr_bg3><font class="bTitle small">최근<font class=eng>30</font>일</font></td>
<? if($infos[12]==1) { ?>
								<td width=14% align=center class=gr_bg3><font class="bTitle small">전체</font></td>
<? } ?>
							</tr>
<?
$values = array();

$infos2 = explode(",",$infos[13]);
$tmps = array();
$values[0][0] = "매출액(원)";
$values[1][0] = "주문건수(건)";

if($infos2[0]==1) $tmps[] = "무통장";
if($infos2[1]==1) $tmps[] = "카드";
if($infos2[2]==1) $tmps[] = "계좌이체";
if($infos2[3]==1) $tmps[] = "핸드폰";		
$values[2][0] = join(" / ",$tmps)."(건)";

$values[3][0] = "결제완료(건)";
$values[4][0] = "취소완료(건)";
$values[5][0] = "배송완료(건)";
$values[6][0] = "상품평(건)";
$values[7][0] = "상품Q&A(건)";
$values[8][0] = "1:1고객문의(건)";
$values[9][0] = "회원가입(명)";
$values[10][0] = "방문자(명)";
$values[11][0] = "상품등록(건)";

if(!$infos[12]) $infos[12] = 0;
for($i=0;$i<(5+$infos[12]);$i++) {
	$sdate = date("Y-m-d", strtotime("-{$date_arr[$i]} DAY", time()));
	$today2 = date("Y-m-d", strtotime('+1 DAY', time()));
	
	if($i<5) {
		if($i==1 || $i==2) {
			$where = "&& INSTR(signdate,'{$sdate}') ";
			$mwhere = "&& INSTR(from_unixtime(signdate),'{$sdate}') ";			
		}
		else {
			$where = "&& signdate >= '{$sdate}'";
			$mwhere = "&& from_unixtime(signdate) >= '{$sdate}'";
		}
	}
	else $where = $mwhere = $cwhere = "";	

	if($infos[0]==1) { 
		$sql = "SELECT SUM(pay_total) as total FROM mall_order_info WHERE uid>0 && order_status !='Z' {$where}" ;
		$values[0][$i+1] = number_format($mysql->get_one($sql),$ckFloatCnt);
	}

	$addwhere = "";

	if($infos[1]==1 || $infos[2]==1 || $infos[3]==1 || $infos[4]==1 || $infos[5]==1) {		
		if($infos[2]==1) {					
			if($infos2[0]==1) $addwhere .= ", SUM(IF(pay_type='B',1,0)) as bacnt";
			if($infos2[1]==1) $addwhere .= ", SUM(IF(pay_type='C',1,0)) as cacnt";
			if($infos2[2]==1) $addwhere .= ", SUM(IF(pay_type='R',1,0)) as racnt";
			if($infos2[3]==1) $addwhere .= ", SUM(IF(pay_type='H',1,0)) as hacnt";		
		}
		if($infos[1]==1) $addwhere .= ", SUM(IF(order_status='A',1,0)) as acnt";
		if($infos[3]==1) $addwhere .= ", SUM(IF(order_status='B',1,0)) as bcnt";
		if($infos[4]==1) $addwhere .= ", SUM(IF(order_status='Z',1,0)) as zcnt";
		if($infos[5]==1) $addwhere .= ", SUM(IF(order_status='E',1,0)) as dcnt";

		
		$sql = "SELECT COUNT(*) as cnt {$addwhere} FROM mall_order_info WHERE uid>0 {$where}";	
		$row = $mysql->one_row($sql);

		if($infos[1]==1) $values[1][$i+1] = number_format($row['cnt']);
		if($infos[3]==1) $values[3][$i+1] = number_format($row['bcnt']);
		if($infos[4]==1) $values[4][$i+1] = number_format($row['zcnt']);
		if($infos[5]==1) $values[5][$i+1] = number_format($row['dcnt']);

		if($infos[2]==1) {
			$tmps = array();
			if($infos2[0]==1) $tmps[] =  number_format($row['bacnt']);
			if($infos2[1]==1) $tmps[] =  number_format($row['cacnt']);
			if($infos2[2]==1) $tmps[] =  number_format($row['racnt']);
			if($infos2[3]==1) $tmps[] =  number_format($row['hacnt']);
			$values[2][$i+1] = join(" / ",$tmps);
		}
	}

	if($infos[6]==1) {
		$sql = "SELECT count(*) FROM mall_goods_point WHERE uid>0 {$mwhere}";
		$values[6][$i+1] = number_format($mysql->get_one($sql));
	}

	if($infos[7]==1) {
		$sql = "SELECT count(*) FROM mall_goods_qna WHERE uid>0 {$mwhere}";
		$values[7][$i+1] = number_format($mysql->get_one($sql));
	}
	
	if($infos[8]==1) {
		$sql = "SELECT count(*) FROM pboard_counsel WHERE no>1 {$mwhere}";
		$values[8][$i+1] = number_format($mysql->get_one($sql));
	}

	if($infos[9]==1) {
		$sql = "SELECT count(*) as cnt FROM pboard_member WHERE uid>1 {$mwhere}"; 
		$values[9][$i+1] = number_format($mysql->get_one($sql));
	}

	if($infos[10]==1) {
		if($i<3) { 
			$sql = "SELECT SUM(total) FROM pcount_list WHERE uid>0 && year = '".substr($sdate,0,4)."' && month = '".substr($sdate,5,2)."' && day = '".substr($sdate,8,2)."'";
		}
		else if($i<5) { 
			if(substr($sdate,5,2) == substr($today2,5,2)) {
				$sql = "SELECT SUM(total) FROM pcount_list WHERE uid>0 && year = '".substr($sdate,0,4)."' && month = '".substr($sdate,5,2)."' && day >= '".substr($sdate,8,2)."'";
			}
			else {
				$tmps1 = 0;
				if(substr($today2,5,2) - substr($sdate,5,2) == 2) {
					$sql = "SELECT SUM(total) FROM pcount_list WHERE uid>0 && year = '".substr($sdate,0,4)."' && month = '".(substr($sdate,5,2)+1)."'";
					$tmps1 = $mysql->get_one($sql);
				}

				$sql = "SELECT SUM(total) FROM pcount_list WHERE uid>0 && year = '".substr($sdate,0,4)."' && month = '".substr($sdate,5,2)."' && day >= '".substr($sdate,8,2)."'";
				$tmps2 = $mysql->get_one($sql);
					

				$sql = "SELECT SUM(total) FROM pcount_list WHERE uid>0 && year = '".substr($today2,0,4)."' && month = '".substr($today2,5,2)."' && day < '".substr($today2,8,2)."'";
				$tmps3 = $mysql->get_one($sql);
				$values[10][$i+1] = number_format($tmps1 + $tmps2 + $tmps3);
			}		
		} 
		else $sql = "SELECT SUM(total) FROM pcount_list WHERE uid>0";		

		if(!$values[10][$i+1]) $values[10][$i+1] = number_format($mysql->get_one($sql));	
	}
	
	if($infos[11]==1) {
		$sql = "SELECT count(*) FROM mall_goods WHERE uid>0 {$mwhere}";
		$values[11][$i+1] = number_format($mysql->get_one($sql));
	}

}

for($i=0;$i<12;$i++) {
	if($infos[$i]==1) {
		echo "		
							<tr height='22' bgcolor='#ffffff' align='center'>
								<td class='small'>{$values[$i][0]}</td>
								<td class='eng'>{$values[$i][1]}</td>
								<td class='eng'>{$values[$i][2]}</td>
								<td class='eng'>{$values[$i][3]}</td>
								<td class='eng'>{$values[$i][4]}</td>
								<td class='eng'>{$values[$i][5]}</td>
		";

		if($infos[12]==1) echo "<td class='eng'>{$values[$i][6]}</td>";

		echo "
							</tr>
		";
	}
}

$where = $mwhere = $cwhere = "";	
?>

							</table>
						</td>
					</tr>
					</table>			  					
				</td>
			</tr>
			</table>
			</div>
		</div>
		<div class="bottom"></div>
		</span>
	</div>
<? 
}
if($admin_infos[6]==1) {
?>	
	<div class="mainBox" id="orderBox">
		<span toggle='drag'>
		<div class="top">
			<div style="padding:7px 0 0 12px;">
				<div class='left'><img src="../html/img/mainBox_ttl_order.gif" alt="최근주문내역" /></div>
				<div style='float:right;padding-right:8px;'>
					<span toggle='expand' attr:min="Gopened(this,'order')" attr:max="Gclosed(this,'order')" attr:animate='none' attr:strata="5"><img src="../html/img/icon_fold.gif" alt="접기" title="접기" class="hand" /></span>
				</div>
				<div style='float:right;padding-right:4px;'>
					<img src="../html/img/icon_conf.gif" alt="설정" title="설정" onclick="confClick('order')" class="hand" />
				</div>
				<div style='float:right;padding-right:8px;'>
					<span toggle='down' attr:animate='none' title="Down" attr:strata="5"><img src="../html/img/icon_down.gif" alt="아래로" class="hand" /></span>
				</div>
				<div style='float:right;padding-right:8px;'>
					<span toggle='up' attr:animate='none' title="Up" attr:strata="5"><img src="../html/img/icon_up.gif" alt="위로" class="hand" /></span>
				</div>
			</div>
		</div>
		</span>
		<span toggle='gadget' style="border:0px; padding:0px; margin:0px;">
		<div class="content">
			<div class='content_top'></div>			
			<div style="padding:0 6px 0 6px;">
			<table border=0 cellpadding=0 cellspacing=3 width=99% bgcolor=#EEEEEE align="center">
			<tr>
				<td>
					<table border=0 cellpadding=0 cellspacing=0 width=100% bgcolor=#bbbbbb>
					<tr>
						<td align=center>
							<table border=0 cellpadding="0" cellspacing="1" width="100%" align=center>
							<tr height=26>									
								<td width=18% align=center class=gr_bg3><font class="bTitle small">주문번호</font></td>
								<td width=11% align=center class=gr_bg3><font class="bTitle small">아이디</font></td>
								<td width=11% align=center class=gr_bg3><font class="bTitle small">주문자</font></td>
								<td width=8% align=center class=gr_bg3><font class="bTitle small">상품건수</font></td>
								<td width=10% align=center class=gr_bg3><font class="bTitle small">결제금액</font></td>
								<td width=15% align=center class=gr_bg3><font class="bTitle small">결제방법</font></td>
								<td width=12% align=center class=gr_bg3><font class="bTitle small">진행상황</font></td>
								<td width=15% align=center class=gr_bg3><font class="bTitle small">주문일</font></td>
							</tr>
<?
$sql = "SELECT code FROM mall_aconf WHERE mode='O'";
$infos = $mysql->get_one($sql);
$infos = explode("|",$infos);

if($infos[0]) $where = "&& a.order_status='{$infos[0]}'";

$query = "SELECT a.uid as uid, a.order_num as order_num, a.id as id, a.name1, a.pay_type, a.pay_status, a.signdate as signdate, a.status_date, a.bank_name, a.use_reserve, a.carriage, a.use_cupon, a.pay_total as sum, a.order_status as status, a.carr_info, a.escrow FROM mall_order_info as a WHERE a.uid>0 {$where} ORDER BY a.uid DESC LIMIT {$infos[1]}";
$mysql->query($query);

$MTlist = Array(11,'uid','order_num','id','name1','cnt','sum','pay_type','signdate');
$pay_arr = Array('A'=>'결제미완료','B'=>'결제성공','C'=>'결제실패');
$pay_arr2 = Array('A'=>'계좌발급완료','B'=>'계좌입금완료','C'=>'결제실패');

while ($row=$mysql->fetch_array()){

	for($i=2;$i<9;$i++){  
        $fd = $MTlist[$i];
		if($i==2) ${"LIST".$i} = "<a href='../order/order_view.php?order_num=$row[order_num]$addstring' onfocus='this.blur();'><font class=eng>$row[$fd]</font></a>"; else ${"LIST".$i} = $row[$fd];      
		 
	}

	if($row['status']=='Z') {
		$sql = "SELECT count(*) FROM mall_order_goods WHERE order_num='{$row[order_num]}'";
	}
	else {
		$sql = "SELECT count(*) FROM mall_order_goods WHERE order_num='{$row[order_num]}' && (order_status!='X' && order_status!='Z' && order_status2!='A')";
	}
	$LIST5 = $mysql->get_one($sql);
	$LIST6 = number_format($LIST6,$ckFloatCnt);	  

	switch($LIST7) {
		case "B" :
			$bank_name = explode(",",$row['bank_name']);
			$LIST7 = "무통장<font class='small'>($bank_name[0])</font>";
		break;
		case "C" :
			$LIST7 = "신용카드<font class='small'>({$pay_arr[$row[pay_status]]})</font>";
		break;
		case "R" :
			$LIST7 = "계좌이체<font class='small'>({$pay_arr[$row[pay_status]]})</font>";
		break;
		case "V" :
			$LIST7 = "가상 계좌이체<font class='small'>({$pay_arr2[$row[pay_status]]})</font>";
		break;
		case "H" :
			$LIST7 = "핸드폰<font class='small'>({$pay_arr[$row[pay_status]]})</font>";
		break;

	}

	$LIST8 = substr($LIST8,0,16);
	  	  
    $LIST10 = $status_arr[$row[status]]; 
?>
							<tr height=22 bgcolor=#FFFFFF>							
								<td align=center><?=$LIST2?></td>
								<td align=center class=eng><a href='#' onclick="pLightBox.show('../member/member_crm.php?mid=<?=$LIST3?>','iframe','700','450','■ <?=$LIST4?>(<?=$LIST3?>) 회원 CRM',10);return false;" title='CRM보기'><?=$LIST3?></a></td>
								<td align=center><?=$LIST4?></td>
								<td align=right style='padding-right:6px;'><font class=eng><?=$LIST5?></font>건</td>
								<td  align=right style='padding-right:6px;'><font class="blue eng"><?=$LIST6?></font>원</td>
								<td align=center><?=$LIST7?></td>
								<td align=center><?=$LIST10?></td>
								<td align=center class=eng><?=$LIST8?></td>
							</tr>
<? 
} 

if($mysql->affected_rows()==0) {
?>
							<tr height=100>
								<td align=center colspan=9 bgcolor=ffffff>주문이 내역이 없습니다.</td>
							</tr>
<? } ?>
							</table>
						</td>
					</tr>
					</table>			  	
				</td>
			</tr>
			</table>
			</div>
		</div>
		<div class="bottom"></div>
		</span>
	</div>
<? 
unset($where);
}
if($admin_infos[7]==1) {
?>
	<div class="mainBox" id="goodsBox">
		<span toggle='drag'>
		<div class="top">
			<div style="padding:7px 0 0 12px;">
				<div class='left'><img src="../html/img/mainBox_ttl_goods.gif" alt="상품관련 통계" /></div>
				<div style='float:right;padding-right:8px;'>
					<span toggle='expand' attr:min="Gopened(this,'goods')" attr:max="Gclosed(this,'goods')" attr:animate='none' attr:strata="5"><img src="../html/img/icon_fold.gif" alt="접기" title="접기" class="hand" /></span>
				</div>
				<div style='float:right;padding-right:4px;'>
					<img src="../html/img/icon_conf.gif" alt="설정" title="설정" onclick="confClick('goods')" class="hand" />
				</div>
				<div style='float:right;padding-right:8px;'>
					<span toggle='down' attr:animate='none' title="Down" attr:strata="5"><img src="../html/img/icon_down.gif" alt="아래로" class="hand" /></span>
				</div>
				<div style='float:right;padding-right:8px;'>
					<span toggle='up' attr:animate='none' title="Up" attr:strata="5"><img src="../html/img/icon_up.gif" alt="위로" class="hand" /></span>
				</div>
			</div>			
		</div>
		</span>
		<span toggle='gadget'>
		<div class="content">
			<div class='content_top'></div>			
			<div style="padding:0 6px 0 6px;">
			<table border=0 cellpadding=0 cellspacing=3 width=99% bgcolor=#EEEEEE align="center">
			<tr>
				<td>
					<table border=0 cellpadding=0 cellspacing=0 width=100% bgcolor=#bbbbbb>
					<tr>
						<td align=center>
							<table border=0 cellpadding="0" cellspacing="1" width="100%" align=center>
							<tr height=26>									
								<td bgcolor="#ffffff">
									<div style="width:100%;overflow:hidden;">

<?
$sql = "SELECT code FROM mall_aconf WHERE mode='G'";
$infos = $mysql->get_one($sql);
$infos = explode("|",$infos);
$lists = array();
for($i=0;$i<9;$i++) {
	if($infos[$i]==1) $lists[] = $i+1;
}
$cnts = $infos[9];
$title_arr = Array('','최근 등록된 상품','최근 품절된 상품','총판매순위','한달간판매순위','한주간판매순위','일판매순위','한달간클릭순위','한주간클릭순위','일클릭순위');

for($i=0,$cnt=count($lists);$i<$cnt;$i++) {
	$title = $title_arr[$lists[$i]];
	switch($lists[$i]){
		case "1" : 
			$links = "../shopping/goods_list.php";
			$sql = "SELECT uid, image4, name, price, cate FROM mall_goods WHERE uid !='' ORDER BY signdate DESC LIMIT {$cnts}";
		break;

		case "2" : 
			$links = "../shopping/goods_list.php?s_qty=2";
			$sql = "SELECT uid, image4, name, price, cate FROM mall_goods WHERE uid !=''&& (s_qty = '2' || (s_qty = '4' && qty=0)) ORDER BY moddate DESC LIMIT {$cnts}";
		break;

		case "3" : 
			$links = "../order/goods_rank.php?mode=o1";
			$sql = "SELECT uid, image4, name, price, cate FROM mall_goods WHERE uid != '0' && o_cnt>0 ORDER BY o_cnt DESC LIMIT {$cnts}";
		break;

		case "4" :  case "5" : case "6" :
			if($lists[$i]==4) $links = '../order/goods_rank.php?mode=o2';
			else if($lists[$i]==5) $links = '../order/goods_rank.php?mode=o3';
			else $links = '../order/goods_rank.php?mode=o4';
	
			if($lists[$i]=='4') { 
				$DAY = date('Y-m-d', strtotime('-1 MONTH', time()));
				$where = "&& a.signdate >= '{$DAY}'";
			}
			else if($lists[$i]=='5') {
				$DAY = date('Y-m-d', strtotime('-1 WEEK', time()));
				$where = "&& a.signdate >= '{$DAY}'";
			}
			else {
				$DAY = date('Y-m-d');
				$where = "&& INSTR(a.signdate,'{$DAY}')";
			}		
			$sql = "SELECT COUNT(a.uid) as o_cnt, p_cate, p_number FROM mall_order_goods a WHERE a.uid!='0' {$where} GROUP BY a.p_number ORDER BY o_cnt DESC LIMIT {$cnts}";
		break;

		case "7" : case "8" : case "9" :
			if($lists[$i]==7) $links = '../order/goods_rank.php?mode=c1';
			else if($lists[$i]==8) $links = '../order/goods_rank.php?mode=c2';
			else $links = '../order/goods_rank.php?mode=c3';

			if($lists[$i]=='7') { 
				$DAY = date('Ymd', strtotime('-1 MONTH', time()));
				$where = "&& a.date >= '{$DAY}'";
			}
			else if($lists[$i]=='8') {
				$DAY = date('Ymd', strtotime('-1 WEEK', time()));
				$where = "&& a.date >= '{$DAY}'";
			}
			else {
				$DAY = date('Ymd');
				$where = "&& INSTR(a.date,'{$DAY}')";
			}
			$sql = "SELECT SUM(a.view) as o_cnt, a.cno FROM mall_goods_view a WHERE a.uid!='0' {$where} GROUP BY a.cno ORDER BY o_cnt DESC LIMIT {$cnts}";
		break;
	}

	if($i%3==1) { $width = "254"; $border = "border-right:1px solid #bbb"; }
	else if($i%3==2) { $width = "255"; $border = "";}
	else { $width = "254"; $border = "border-right:1px solid #bbb"; }
	if($i>2) $border2 = "border-top:1px solid #bbb";
?>
										<div style="width:<?=$width?>px;overflow:hidden;float:left;min-height:163px;background-color:#fff;<?=$border?>">
											<div style="height:26px;background-color:#efefef;border-bottom:1px solid #bbb;<?=$border2?>" class="hand" onclick="window.location.href='<?=$links?>';">
												<div style='padding-top:8px'><font class="bTitle small"><?=$title?></font></div>
											</div>
											<div style="padding-left:2px;">
<?		
	$mysql->query($sql);
	while($row2 = $mysql->fetch_array()){
		if($lists[$i]>3) {
			if($row2['cno']) {
				$tmp_cate	= substr($row2['cno'],0,12);
				$tmp_number = substr($row2['cno'],12);
			}
			else {
				$tmp_cate	= $row2['p_cate'];
				$tmp_number = $row2['p_number'];
			}
		
			$sql = "SELECT uid, image4, name, price, cate FROM mall_goods WHERE uid>0 && uid='{$tmp_number}'";
			if(!$row = $mysql->one_row($sql)) continue;
			$row['cate'] = $tmp_cate;
		}
		else $row = $row2;

		$NAME	= htmlspecialchars(stripslashes($row['name']));
		$PRICE	= number_format($row['price'],$ckFloatCnt);
?>
												<div style='height:135px;' class="small goodsDiv">								
													<div style="text-align:center"><a href='<?=$SMain?>?channel=view&uid=<?=$row['uid'];?>&cate=<?=$row['cate']?>' target='_blank' title='쇼핑몰 상세설명 보기'><img src='../../image/goods_img<?=$row['image4']?>' border=0 width=80 height=80></a></div>
													<div style="padding-top:4px;height:24px;overflow:hidden"><a href='../shopping/goods_write.php?mode=modify&uid=<?=$row['uid']?>' target='_blank' title='상품수정하기'><?=$NAME?></a></div>
													<div class="eng green"><?=$PRICE?>원</div>
												</div>
<? 
	} 
		echo "								</div>
										</div>
		";
}

for($i2=$i;$i2<$i+3;$i2++) {
	
	if($i2%3==1) { $width = "254"; $border = "border-right:1px solid #bbb"; }
	else if($i2%3==2) { $width = "255"; $border = "";}
	else break;
	
	if($i>2) $border2 = "border-top:1px solid #bbb";

	echo "								<div style='width:{$width}px;overflow:hidden;float:left;min-height:163px;background-color:#fff;{$border}'>
											<div style='height:26px;background-color:#efefef;border-bottom:1px solid #bbb;{$border2}'></div>											
										</div>
	";

	$i++;
}
?>

									</div>
								</td>	
							</tr>
							</table>
						</td>
					</tr>
					</table>			  					
				</td>
			</tr>
			</table>
			</div>
		</div>
		<div class="bottom"></div>
		</span>		
	</div>
<? 
unset($title,$links,$where,$cnts,$border,$border2,$width);
}
if($admin_infos[8]==1) {
?>
	<div class="mainBox" id="boardBox">
		<span toggle='drag'>
		<div class="top">
			<div style="padding:7px 0 0 12px;">
				<div class='left'><img src="../html/img/mainBox_ttl_board.gif" alt="최근등록된글" /></div>
				<div style='float:right;padding-right:8px;'>
					<span toggle='expand' attr:min="Gopened(this,'board')" attr:max="Gclosed(this,'board')" attr:animate='none' attr:strata="5"><img src="../html/img/icon_fold.gif" alt="접기" title="접기" class="hand" /></span>
				</div>
				<div style='float:right;padding-right:4px;'>
					<img src="../html/img/icon_conf.gif" alt="설정" title="설정" onclick="confClick('board')" class="hand" />
				</div>
				<div style='float:right;padding-right:8px;'>
					<span toggle='down' attr:animate='none' title="Down" attr:strata="5"><img src="../html/img/icon_down.gif" alt="아래로" class="hand" /></span>
				</div>
				<div style='float:right;padding-right:8px;'>
					<span toggle='up' attr:animate='none' title="Up" attr:strata="5"><img src="../html/img/icon_up.gif" alt="위로" class="hand" /></span>
				</div>
			</div>			
		</div>
		</span>
		<span toggle='gadget'>
		<div class="content">
			<div class='content_top'></div>			
			<div style="padding:0 6px 0 6px;">
			<table border=0 cellpadding=0 cellspacing=3 width=99% bgcolor=#EEEEEE align="center">
			<tr>
				<td>
					<table border=0 cellpadding=0 cellspacing=0 width=100% bgcolor=#bbbbbb>
					<tr>
						<td align=center>
							<table border=0 cellpadding="0" cellspacing="1" width="100%" align=center>
							<tr height=26>									
								<td bgcolor="#ffffff">
									<div style="width:100%;overflow:hidden;">

<?
$sql = "SELECT code FROM mall_aconf WHERE mode='B'";
$infos = $mysql->get_one($sql);
$infos = explode("|",$infos);
$lists = array();
if($infos[0]==1) $lists[] = "itsmall_notice";
if($infos[1]==1) $lists[] = "itsmall_update";
if($infos[2]==1) $lists[] = "point";
if($infos[3]==1) $lists[] = "qna";
$lists[] = $infos[4];
$cnts = $infos[5];
$lists = join(",",$lists);
$lists = explode(",",$lists);

$sql = "SELECT name, title FROM pboard_manager";
$mysql->query($sql);
$board_arr = array();
while($row = $mysql->fetch_array()){
	$board_arr[$row['name']] = $row['title'];
}

include "class.miniRss.php"; 

for($i=0,$cnt=count($lists);$i<$cnt;$i++) {
	if($lists[$i]=="itsmall_notice") {
		$contents = '';
		$title = "잇츠몰 공지";
		$links = "window.open('http://www.itsmall.kr/index.php?channel=customer01');";
		$rss = new classMRss("http://www.itsmall.kr/rss/board2.php?code=notice",'10');
		$rss->parse();
		$contents= $rss->Items();
		$rss->close();
	}
	else if($lists[$i]=="itsmall_update") {
		$contents = '';
		$title = "잇츠몰 업데이트";
		$links = "window.open('http://www.itsmall.kr/index.php?channel=customer02');";
		$rss = new classMRss("http://www.itsmall.kr/rss/board2.php?code=update",'10');
		$rss->parse();
		$contents= $rss->Items();
		$rss->close();
	}
	else if($lists[$i]=="point") {
		$title = "상품평";
		$links = "window.location.href='../multi_board/board.php?code=goods_point';";
		$sql = "SELECT uid, title, signdate FROM mall_goods_point ORDER BY uid desc LIMIT {$cnts}";
	}
	else if($lists[$i]=="qna") {
		$title = "상품Q&A";
		$links = "window.location.href='../multi_board/board.php?code=goods_qna';";
		$sql = "SELECT uid, title, signdate FROM mall_goods_qna ORDER BY uid desc LIMIT {$cnts}";
	} 
	else {
		$sql = "SELECT count(*) from pboard_manager WHERE name='{$lists[$i]}'";
		if($mysql->get_one($sql)==0) continue;
		$ck_board = 'Y';
		$title = $board_arr[$lists[$i]];
		$links = "window.location.href='../board/board.html?code={$lists[$i]}';";
		$sql = "SELECT no as uid,subject as title, signdate FROM pboard_{$lists[$i]} WHERE no>1 ORDER BY no DESC limit 0,{$cnts}";
	}

	if($i%3==1) { $width = "254"; $border = "border-right:1px solid #bbb"; }
	else if($i%3==2) { $width = "255"; $border = "";}
	else { $width = "254"; $border = "border-right:1px solid #bbb"; }

	if($i>2) $border2 = "border-top:1px solid #bbb";
			
?>
										<div style="width:<?=$width?>px;overflow:hidden;float:left;background-color:#fff;<?=$border?>">
											<div style="height:26px;background-color:#efefef;border-bottom:1px solid #bbb;<?=$border2?>" class="hand" onclick="<?=$links?>">
												<div style='padding-top:8px'><font class="bTitle small"><?=$title?></font></div>
											</div>
											<div style="height:4px;overflow:hidden">&nbsp;</div>
<?	
	if($lists[$i]=="itsmall_notice" || $lists[$i]=="itsmall_update") {
		for($j=0;$j<$cnts;$j++) {
			if($contents[$j]) {
				$items = explode("|",$contents[$j]);
				$items[0] = iconv("euc-kr","utf-8",$items[0]);
				echo "<div style='height:13px;padding:1px 1px 1px 4px;width:240px;overflow:hidden;text-align:left;'><img src='img/m_jum.gif' border=0 alt='dot'><font class='eng'>[{$items[1]}]</font> <a href='{$items[2]}' class='small' title='{$items[0]}' target='_blank'>{$items[0]}</a></div>";
			}
			else {
				echo "<div style='height:13px;padding:1px 1px 1px 4px;width:240px;overflow:hidden;text-align:left;'><img src='img/m_jum.gif' border=0 alt='dot'></div>";
			}
		}
	}
	else {
		$mysql->query($sql);
		for($j=0;$j<$cnts;$j++) {
			if($row = $mysql->fetch_array()){
				$row['title'] =  htmlspecialchars(stripslashes($row['title']));	
				$row['signdate'] = date("m-d",$row['signdate']);
				$links = str_replace("';","",$links);
				if($ck_board=='Y') $link = "{$links}&pmode=view&no={$row['uid']}'";
				else $link = "{$links}&mode=modify&uid={$row['uid']}'";
				echo "<div style='height:13px;padding:1px 1px 1px 4px;width:240px;overflow:hidden;text-align:left;'><img src='img/m_jum.gif' border=0 alt='dot'><font class='eng'>[{$row['signdate']}]</font> <a href='#' onclick=\"{$link};return false;\" class='small' title='{$row['title']}'>{$row['title']}</a></div>";
			}
			else {
				echo "<div style='height:13px;padding:1px 1px 1px 4px;width:240px;overflow:hidden;text-align:left;'><img src='img/m_jum.gif' border=0 alt='dot'></div>";
			}
		}
	}

	
?>											
											<div style="height:4px;overflow:hidden">&nbsp;</div>
										</div>
<? 
} 

for($i2=$i;$i2<$i+3;$i2++) {
	
	if($i2%3==1) { $width = "254"; $border = "border-right:1px solid #bbb"; }
	else if($i2%3==2) { $width = "255"; $border = "";}
	else break;
	
	if($i>2) $border2 = "border-top:1px solid #bbb";

	echo "								<div style='width:{$width}px;overflow:hidden;float:left;background-color:#fff;{$border}'>
											<div style='height:26px;background-color:#efefef;border-bottom:1px solid #bbb;{$border2}'></div>											
										</div>
	";

	$i++;
}

unset($title,$links,$where,$cnts,$border,$border2,$width);
?>										

									</div>
								</td>	
							</tr>
							</table>
						</td>
					</tr>
					</table>			  					
				</td>
			</tr>
			</table>
			</div>
		</div>
		<div class="bottom"></div>
		</span>		
	</div>
<? } ?>
</div>

<div id="list_loading">
	<div class="top"><img src="../html/img/ing_box_top.gif" alt='box top' style="vertical-align:bottom" /></div>
	<div class="center small" style="background:url(../html/img/ing_box_bg.gif)">				
		<br/>
		데이타를 가져오는 중입니다.
		<br/><br/>
		<img src='../html/img/common/bigWaiting.gif' border='0' alt="waitong..." />
	</div>
	<div class="bottom"><img src="../html/img/ing_box_bottom.gif" alt='box bottom' style="vertical-align:top" /></div>
</div>


<SCRIPT LANGUAGE="JavaScript">
<!--
var xts=new xwzGadgetry('IDS_DIV_FRAME1','SPAN',1,3);
var xts2=new xwzGadgetry('IDS_DIV_FRAME2','SPAN',1,3);
window.onload=function(){	
	if(document.getElementById("infoBox")) document.getElementById("infoBox").style.display='block';
	if(document.getElementById("menuBox"))document.getElementById("menuBox").style.display='block';
	if(document.getElementById("siteBox"))document.getElementById("siteBox").style.display='block';
	if(document.getElementById("calBox"))document.getElementById("calBox").style.display='block';
	if(document.getElementById("memBox"))document.getElementById("memBox").style.display='block';

	if(document.getElementById("totalBox"))document.getElementById("totalBox").style.display='block';
	if(document.getElementById("orderBox"))document.getElementById("orderBox").style.display='block';
	if(document.getElementById("boardBox"))document.getElementById("boardBox").style.display='block';
	if(document.getElementById("goodsBox"))document.getElementById("goodsBox").style.display='block';
	
	document.getElementById("list_loading").style.display='none';

	xts.load();
	xts2.load();	
}

function Gopened(obj,name){
    obj.innerHTML = "<img src='../html/img/icon_open.gif' alt='열기' title='열기' class='hand' />";		
}
function Gclosed(obj,name){	
	obj.innerHTML = "<img src='../html/img/icon_fold.gif' alt='접기' title='접기' class='hand' />";		
}

function confClick(type) {
	exec = 'html';
	switch(type) {
		case "info" :	ttl = '쇼핑몰 정보 설정'; height = 270; width = 445; callback = ''; break;
		case "menu" :	ttl = '자주 사용하는 메뉴 설정'; height = 410; width = 740; callback = ''; break;
		case "site" :	ttl = '자주 가는 사이트 설정'; height = 300; width = 740; callback = "parent.location.reload();"; break;
		case "total" :	ttl = '쇼핑몰 통계 설정'; height = 380; width = 445; callback = ''; break;
		case "schedule" :	ttl = '일정 설정'; height = 450; width = 660; callback = ''; exec = 'php'; break;
		case "order" :	ttl = '최근 주문내역 설정'; height = 270; width = 445; callback = ''; break;
		case "board" :	ttl = '최근 등록된 글 설정'; height = 400; width = 445; callback = ''; break;
		case "goods" :	ttl = '상품관련 통계 설정'; height = 340; width = 445; callback = ''; break;
		case "member" :	ttl = '회원 통계 설정'; height = 240; width = 445; callback = ''; break;
	}

	pLightBox.show(type+'_conf.'+exec,'iframe', width, height,'■ '+ttl,30,callback);
	return false;
}

//-->
</SCRIPT>		

<? include "../html/bottom_inc.html"; ?>